
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../Elements/StateMachine/">
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.8">
    
    
      
        <title>AsyncStateMachineInterpreter - StateForward</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#stateforward.state_machine.interpreters.AsyncStateMachineInterpreter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="StateForward" class="md-header__button md-logo" aria-label="StateForward" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            StateForward
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AsyncStateMachineInterpreter
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="StateForward" class="md-nav__button md-logo" aria-label="StateForward" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    StateForward
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Examples/LightSwitch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LightSwitch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Examples/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Examples/TrafficLight/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TrafficLight
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modeling
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Modeling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Modeling/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4_2" >
        
          
          <label class="md-nav__link" for="__nav_2_4_2" id="__nav_2_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Modeling/API/Association/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Association
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Modeling/API/Collection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Collection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Modeling/API/Element/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Element
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Modeling/API/ElementInterface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ElementInterface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Modeling/API/Model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Modeling/API/Preprocessor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocessor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" checked>
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    StateMachine
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            StateMachine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Preprocessor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocessor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5_3" >
        
          
          <label class="md-nav__link" for="__nav_2_5_3" id="__nav_2_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Elements
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_3">
            <span class="md-nav__icon md-icon"></span>
            Elements
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Elements/Behavior/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Behavior
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Elements/CompositeState/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CompositeState
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Elements/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Elements/StateMachine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StateMachine
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_5_4" id="__nav_2_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Interpreters
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_5_4">
            <span class="md-nav__icon md-icon"></span>
            Interpreters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    AsyncStateMachineInterpreter
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    AsyncStateMachineInterpreter
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#stateforward.state_machine.interpreters.AsyncStateMachineInterpreter" class="md-nav__link">
    AsyncStateMachineInterpreter
  </a>
  
    <nav class="md-nav" aria-label="AsyncStateMachineInterpreter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stateforward.state_machine.interpreters.AsyncStateMachineInterpreter.process_event" class="md-nav__link">
    process_event()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#stateforward.state_machine.interpreters.AsyncStateMachineInterpreter" class="md-nav__link">
    AsyncStateMachineInterpreter
  </a>
  
    <nav class="md-nav" aria-label="AsyncStateMachineInterpreter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stateforward.state_machine.interpreters.AsyncStateMachineInterpreter.process_event" class="md-nav__link">
    process_event()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>AsyncStateMachineInterpreter</h1>

<div class="doc doc-object doc-class">




<h2 id="stateforward.state_machine.interpreters.AsyncStateMachineInterpreter" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">AsyncStateMachineInterpreter</span>


</h2>


  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><span title="stateforward.state_machine.interpreters.asynchronous.behavior_interpreter.AsyncBehaviorInterpreter">AsyncBehaviorInterpreter</span></code></p>

  
      <p>An asynchronous state machine interpreter responsible for processing events
and managing state transitions within an asynchronous environment.</p>
<p>The interpreter leverages Python's asyncio library to handle the execution
of state machine behaviors, ensuring non-blocking operations.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="stateforward.elements.elements.StateMachine" href="../../Elements/StateMachine/#stateforward.elements.StateMachine">StateMachine</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The state machine to be interpreted.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>idle</code></td>
          <td>
                <code><span title="asyncio.Event">Event</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An event to indicate if the interpreter is idle.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>tasks</code></td>
          <td>
                <code>dict[<a class="autorefs autorefs-internal" title="stateforward.model.element.Element" href="../../../Modeling/API/Element/#stateforward.model.Element">Element</a>, <span title="asyncio.Future">Future</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A mapping of elements (e.g., states) to
their respective awaitable task objects.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>stateforward/state_machine/interpreters/asynchronous/state_machine_interpreter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AsyncStateMachineInterpreter</span><span class="p">(</span><span class="n">AsyncBehaviorInterpreter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An asynchronous state machine interpreter responsible for processing events</span>
<span class="sd">    and managing state transitions within an asynchronous environment.</span>

<span class="sd">    The interpreter leverages Python&#39;s asyncio library to handle the execution</span>
<span class="sd">    of state machine behaviors, ensuring non-blocking operations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        model (StateMachine): The state machine to be interpreted.</span>
<span class="sd">        idle (asyncio.Event): An event to indicate if the interpreter is idle.</span>
<span class="sd">        tasks (dict[Element, asyncio.Future]): A mapping of elements (e.g., states) to</span>
<span class="sd">            their respective awaitable task objects.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span><span class="p">:</span> <span class="s2">&quot;elements.StateMachine&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronously handles an incoming event and determines the resultant state machine processing action.</span>

<span class="sd">        This method looks through the active regions and states of the state machine and attempts to process</span>
<span class="sd">        the event. If any transitions match the event and its associated guard conditions, those transitions</span>
<span class="sd">        are taken, and the state machine moves to the next appropriate state(s).</span>

<span class="sd">        Args:</span>
<span class="sd">            event (Event): The event instance to be processed by the state machine.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Processing: An enumeration value indicating the result of the event processing. This value can</span>
<span class="sd">                        be Processing.complete if the event led to a transition, Processing.incomplete if the</span>
<span class="sd">                        event did not lead to a transition, or Processing.deferred if the event processing is</span>
<span class="sd">                        ongoing or deferred.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If no valid transitions are found for a choice pseudostate. This situation</span>
<span class="sd">                       indicates a model error where a choice cannot make a valid decision based on the</span>
<span class="sd">                       guards of its outgoing transitions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># could possibly improve this with using state in reverse</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">complete</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">complete</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_region</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">Region</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">Event</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_active</span><span class="p">(</span><span class="n">region</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span>
        <span class="n">active_state</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span><span class="n">state</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">region</span><span class="o">.</span><span class="n">subvertex</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_active</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">active_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span><span class="p">(</span><span class="n">active_state</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">Event</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_active</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">result</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                        <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span>
            <span class="p">),</span>
            <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_vertex</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">transition</span> <span class="ow">in</span> <span class="n">vertex</span><span class="o">.</span><span class="n">outgoing</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_transition</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
                <span class="o">==</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">complete</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">complete</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">transition</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Transition</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">_event</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">event</span><span class="p">),</span> <span class="n">elements</span><span class="o">.</span><span class="n">AnyEvent</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">_event</span> <span class="ow">in</span> <span class="n">transition</span><span class="o">.</span><span class="n">events</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_constraint</span><span class="p">(</span><span class="n">transition</span><span class="o">.</span><span class="n">guard</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_transition</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">complete</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span>

        <span class="c1"># could possibly improve this with using state in reverse</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">evaluate_constraint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">constraint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">leave_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">State</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leave_transition</span><span class="p">(</span><span class="n">transition</span><span class="p">)</span> <span class="k">for</span> <span class="n">transition</span> <span class="ow">in</span> <span class="n">vertex</span><span class="o">.</span><span class="n">outgoing</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">leave_state</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">leave_psuedostate</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_active</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">execute_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">transition</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Transition</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leave_vertex</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">transition</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">leave</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">await</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_behavior</span><span class="p">(</span><span class="n">transition</span><span class="o">.</span><span class="n">effect</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enter_vertex</span><span class="p">(</span>
                    <span class="n">vertex</span><span class="p">,</span>
                    <span class="n">event</span><span class="p">,</span>
                    <span class="n">elements</span><span class="o">.</span><span class="n">EntryKind</span><span class="o">.</span><span class="n">default</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">transition</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">enter</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">else</span> <span class="n">elements</span><span class="o">.</span><span class="n">EntryKind</span><span class="o">.</span><span class="n">explicit</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transition</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">leave_transition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Transition</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">(</span><span class="o">*</span><span class="n">transition</span><span class="o">.</span><span class="n">events</span><span class="p">,</span> <span class="n">transition</span><span class="o">.</span><span class="n">events</span><span class="p">,</span> <span class="n">transition</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_active</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">enter_vertex</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">EntryKind</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_active</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">State</span><span class="p">):</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_state</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enter_transition</span><span class="p">(</span><span class="n">transition</span><span class="p">)</span> <span class="k">for</span> <span class="n">transition</span> <span class="ow">in</span> <span class="n">vertex</span><span class="o">.</span><span class="n">outgoing</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">FinalState</span><span class="p">):</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_final_state</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_psuedostate</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">enter_final_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">FinalState</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">leave_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_active</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">enter_change_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">ChangeEvent</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="n">_self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">_condition</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">condition</span><span class="p">()):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_event</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">_event</span><span class="p">):</span>
                    <span class="n">_self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">_event</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">wait</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">enter_time_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">TimeEvent</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="n">_self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_event</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_active</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">wait</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">enter_completion_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">CompletionEvent</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="n">_self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">_source</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">owner</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">_self</span><span class="o">.</span><span class="n">get_active</span><span class="p">(</span>
                <span class="n">_source</span><span class="o">.</span><span class="n">do_activity</span>
            <span class="p">)</span>  <span class="c1"># wait for the activity of the state to complete</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span>
                    <span class="n">_self</span><span class="o">.</span><span class="n">get_active</span><span class="p">(</span><span class="n">active</span><span class="o">.</span><span class="n">do_activity</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">active</span> <span class="ow">in</span> <span class="n">_self</span><span class="o">.</span><span class="n">active</span>
                    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">is_subtype</span><span class="p">(</span><span class="n">active</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">State</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">active</span><span class="o">.</span><span class="n">qualified_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">_source</span><span class="o">.</span><span class="n">qualified_name</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_active</span><span class="p">(</span><span class="n">_event</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">wait</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">enter_call_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">CallEvent</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="n">_self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">_event</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">results</span>
            <span class="n">_self</span><span class="o">.</span><span class="n">add_active</span><span class="p">(</span><span class="n">_event</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">wait</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">enter_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">TimeEvent</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_time_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">CompletionEvent</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_completion_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">CallEvent</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_call_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">ChangeEvent</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_change_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">enter_transition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Transition</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_active</span><span class="p">(</span><span class="n">transition</span><span class="p">)</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">transition</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enter_event</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_active</span><span class="p">(</span>
            <span class="n">transition</span><span class="o">.</span><span class="n">events</span><span class="p">,</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">),</span> <span class="kc">None</span><span class="p">)),</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">enter_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">EntryKind</span>
    <span class="p">):</span>
        <span class="k">await</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_behavior</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">entry</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">state</span><span class="o">.</span><span class="n">entry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_behavior</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">do_activity</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">submachine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_state_machine</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">submachine</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">enter_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">region</span> <span class="ow">or</span> <span class="p">[]</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">enter_state_machine</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">state_machine</span><span class="p">:</span> <span class="s2">&quot;elements.StateMachine&quot;</span><span class="p">,</span>
        <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">EntryKind</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enter_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">state_machine</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">enter_region</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Region</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">EntryKind</span>
    <span class="p">):</span>
        <span class="n">states</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="n">elements</span><span class="o">.</span><span class="n">EntryKind</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">region</span><span class="o">.</span><span class="n">initial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">states</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_active</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_psuedostate</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">initial</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_active</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">states</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">leave_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Region</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
        <span class="n">active_vertex</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span><span class="n">vertex</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">region</span><span class="o">.</span><span class="n">subvertex</span> <span class="k">if</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">active_vertex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">leave_vertex</span><span class="p">(</span><span class="n">active_vertex</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_active</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">leave_psuedostate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">psuedostate</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Pseudostate</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span>
    <span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">leave_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">submachine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">leave_state_machine</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">submachine</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leave_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">region</span> <span class="ow">or</span> <span class="p">[])</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_active</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">do_activity</span><span class="p">)</span>
        <span class="k">await</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_behavior</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">exit</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">leave_state_machine</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">state_machine</span><span class="p">:</span> <span class="s2">&quot;elements.StateMachine&quot;</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span>
    <span class="p">):</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leave_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">state_machine</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">enter_psuedostate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">psuedostate</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Pseudostate</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">Event</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">psuedostate</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">elements</span><span class="o">.</span><span class="n">PseudostateKind</span><span class="o">.</span><span class="n">initial</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_transition</span><span class="p">(</span><span class="n">psuedostate</span><span class="o">.</span><span class="n">outgoing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">psuedostate</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">elements</span><span class="o">.</span><span class="n">PseudostateKind</span><span class="o">.</span><span class="n">choice</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">transition</span> <span class="ow">in</span> <span class="n">psuedostate</span><span class="o">.</span><span class="n">outgoing</span><span class="p">:</span>
                <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_constraint</span><span class="p">(</span><span class="n">transition</span><span class="o">.</span><span class="n">guard</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
                    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_transition</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;no valid transition this should never throw&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">psuedostate</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">elements</span><span class="o">.</span><span class="n">PseudostateKind</span><span class="o">.</span><span class="n">join</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">transition</span><span class="o">.</span><span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span>
                <span class="k">for</span> <span class="n">transition</span> <span class="ow">in</span> <span class="n">psuedostate</span><span class="o">.</span><span class="n">incoming</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_transition</span><span class="p">(</span><span class="n">psuedostate</span><span class="o">.</span><span class="n">outgoing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">psuedostate</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">elements</span><span class="o">.</span><span class="n">PseudostateKind</span><span class="o">.</span><span class="n">fork</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">execute_transition</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">transition</span> <span class="ow">in</span> <span class="n">psuedostate</span><span class="o">.</span><span class="n">outgoing</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_state_machine</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">EntryKind</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">machine</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">leave_state_machine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="stateforward.state_machine.interpreters.AsyncStateMachineInterpreter.process_event" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">process_event</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">process_event</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Asynchronously handles an incoming event and determines the resultant state machine processing action.</p>
<p>This method looks through the active regions and states of the state machine and attempts to process
the event. If any transitions match the event and its associated guard conditions, those transitions
are taken, and the state machine moves to the next appropriate state(s).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>event</code></td>
          <td>
                <code><span title="stateforward.elements.elements.Event">Event</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The event instance to be processed by the state machine.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Processing</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An enumeration value indicating the result of the event processing. This value can
        be Processing.complete if the event led to a transition, Processing.incomplete if the
        event did not lead to a transition, or Processing.deferred if the event processing is
        ongoing or deferred.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>Exception</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If no valid transitions are found for a choice pseudostate. This situation
       indicates a model error where a choice cannot make a valid decision based on the
       guards of its outgoing transitions.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>stateforward/state_machine/interpreters/asynchronous/state_machine_interpreter.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Asynchronously handles an incoming event and determines the resultant state machine processing action.</span>

<span class="sd">    This method looks through the active regions and states of the state machine and attempts to process</span>
<span class="sd">    the event. If any transitions match the event and its associated guard conditions, those transitions</span>
<span class="sd">    are taken, and the state machine moves to the next appropriate state(s).</span>

<span class="sd">    Args:</span>
<span class="sd">        event (Event): The event instance to be processed by the state machine.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Processing: An enumeration value indicating the result of the event processing. This value can</span>
<span class="sd">                    be Processing.complete if the event led to a transition, Processing.incomplete if the</span>
<span class="sd">                    event did not lead to a transition, or Processing.deferred if the event processing is</span>
<span class="sd">                    ongoing or deferred.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If no valid transitions are found for a choice pseudostate. This situation</span>
<span class="sd">                   indicates a model error where a choice cannot make a valid decision based on the</span>
<span class="sd">                   guards of its outgoing transitions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># could possibly improve this with using state in reverse</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">complete</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">complete</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">incomplete</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.top", "navigation.indexes", "navigation.expand", "search.highlight", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.81fa17fe.min.js"></script>
      
    
  </body>
</html>